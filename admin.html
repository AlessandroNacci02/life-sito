<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Admin Recensioni</title>
  <style>
    body { font-family: sans-serif; background: #f7f7f7; margin: 0; padding: 30px; }
    .review { background: #fff; border-radius: 10px; margin-bottom: 18px; padding: 18px; box-shadow: 0 2px 8px #0001; }
    .delete-btn { background: #d32f2f; color: #fff; border: none; padding: 6px 14px; border-radius: 8px; cursor: pointer; margin-top: 8px; }
    .stars { color: #F59E0B; font-size: 1.2em; }
  </style>
</head>
<body>
  <h2>Gestione recensioni</h2>
  <div>
    <input type="password" id="adminPass" placeholder="Password admin" style="padding:8px;border-radius:8px;border:1px solid #e5e7eb;">
    <button id="loginBtn">Accedi</button>
  </div>
  <div id="adminArea" style="display:none;">
    <h3>Recensioni ricevute</h3>
    <div id="reviews"></div>
  </div>
  <script>
    const API = 'https://life-backend-u7m1.onrender.com/api/reviews';
    let adminPass = '';

    document.getElementById('loginBtn').onclick = function() {
      adminPass = document.getElementById('adminPass').value;
      if (!adminPass) return alert('Inserisci la password');
      document.getElementById('adminArea').style.display = 'block';
      this.style.display = 'none';
      document.getElementById('adminPass').style.display = 'none';
      loadReviews();
    };

    function loadReviews() {
      fetch(API)
        .then(r => r.json())
        .then(arr => {
          const reviewsDiv = document.getElementById('reviews');
          reviewsDiv.innerHTML = '';
          if (!arr.length) {
            reviewsDiv.innerHTML = '<p>Nessuna recensione presente.</p>';
            return;
          }
          arr.forEach(r => {
            const div = document.createElement('div');
            div.className = 'review';
            div.innerHTML = `
              <div><b>${r.name} ${r.surname}</b> — ${r.city} (${r.province})</div>
              <div class="stars">${'★'.repeat(r.stars)}${'☆'.repeat(5 - r.stars)}</div>
              <div>${r.text}</div>
              <div style="font-size:0.95em;color:#888;">${r.date}</div>
              <button class="delete-btn" data-id="${r.id}">Elimina</button>
            `;
            reviewsDiv.appendChild(div);
          });
        });
    }

    document.getElementById('reviews').onclick = function(e) {
      if (e.target.classList.contains('delete-btn')) {
        const id = e.target.getAttribute('data-id');
        if (!confirm('Sei sicuro di voler eliminare questa recensione?')) return;
        fetch(API + '/' + id, {
          method: 'DELETE',
          headers: { 'x-admin-pass': adminPass }
        }).then(r => {
          if (r.ok) {
            e.target.closest('.review').remove();
          } else {
            alert('Errore nella cancellazione (password errata?)');
          }
        });
      }
    };
  </script>
</body>
</html>